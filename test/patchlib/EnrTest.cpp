/**
 * @file EnrTest.cpp
 *
 * @author Dan Keenan
 * @date 12/12/23
 * @copyright GNU GPLv3
 */

#include <catch2/catch_test_macros.hpp>
#include <catch2/matchers/catch_matchers_range_equals.hpp>
#include <QByteArray>
#include <QFile>
#include "patchlib/Enr.h"
#include "patchlib/Exceptions.h"
#include "Formatters.h"

class EnrFixture
{
protected:
    QByteArray romBin_;
    patchman::EnrRom *rom_;

public:
    explicit EnrFixture()
    {
        QFile romFile(QString("%1/roms/enr_bal_294.bin").arg(TEST_SOURCES_DIR));
        if (!romFile.open(QFile::ReadOnly)) {
            FAIL("Failed to open fixture rom file.");
        }
        romBin_ = romFile.readAll();

        rom_ = dynamic_cast<patchman::EnrRom *>(patchman::Rom::create(patchman::Rom::Type::ENR));
        rom_->setVersion(patchman::EnrRom::Version::EnrRack294);
        patchman::Rack *rack;

        // Rack 0
        rack = rom_->addRack(0, patchman::Rack::Type::Enr96);
        rack->setLugAddress(0, 1);
        rack->setLugAddress(1, 2);
        rack->setLugAddress(2, 7);
        rack->setLugAddress(3, 8);
        rack->setLugAddress(4, 13);
        rack->setLugAddress(5, 14);
        rack->setLugAddress(6, 19);
        rack->setLugAddress(7, 20);
        rack->setLugAddress(8, 25);
        rack->setLugAddress(9, 26);
        rack->setLugAddress(10, 31);
        rack->setLugAddress(11, 32);
        rack->setLugAddress(12, 37);
        rack->setLugAddress(13, 38);
        rack->setLugAddress(14, 43);
        rack->setLugAddress(15, 44);
        rack->setLugAddress(16, 49);
        rack->setLugAddress(17, 50);
        rack->setLugAddress(18, 55);
        rack->setLugAddress(19, 56);
        rack->setLugAddress(20, 61);
        rack->setLugAddress(21, 62);
        rack->setLugAddress(22, 67);
        rack->setLugAddress(23, 68);
        rack->setLugAddress(24, 73);
        rack->setLugAddress(25, 74);
        rack->setLugAddress(26, 79);
        rack->setLugAddress(27, 80);
        rack->setLugAddress(28, 85);
        rack->setLugAddress(29, 86);
        rack->setLugAddress(30, 91);
        rack->setLugAddress(31, 92);
        rack->setLugAddress(32, 3);
        rack->setLugAddress(33, 4);
        rack->setLugAddress(34, 9);
        rack->setLugAddress(35, 10);
        rack->setLugAddress(36, 15);
        rack->setLugAddress(37, 16);
        rack->setLugAddress(38, 21);
        rack->setLugAddress(39, 22);
        rack->setLugAddress(40, 27);
        rack->setLugAddress(41, 28);
        rack->setLugAddress(42, 33);
        rack->setLugAddress(43, 34);
        rack->setLugAddress(44, 39);
        rack->setLugAddress(45, 40);
        rack->setLugAddress(46, 45);
        rack->setLugAddress(47, 46);
        rack->setLugAddress(48, 51);
        rack->setLugAddress(49, 52);
        rack->setLugAddress(50, 57);
        rack->setLugAddress(51, 58);
        rack->setLugAddress(52, 63);
        rack->setLugAddress(53, 64);
        rack->setLugAddress(54, 69);
        rack->setLugAddress(55, 70);
        rack->setLugAddress(56, 75);
        rack->setLugAddress(57, 76);
        rack->setLugAddress(58, 81);
        rack->setLugAddress(59, 82);
        rack->setLugAddress(60, 87);
        rack->setLugAddress(61, 88);
        rack->setLugAddress(62, 93);
        rack->setLugAddress(63, 94);
        rack->setLugAddress(64, 5);
        rack->setLugAddress(65, 6);
        rack->setLugAddress(66, 11);
        rack->setLugAddress(67, 12);
        rack->setLugAddress(68, 17);
        rack->setLugAddress(69, 18);
        rack->setLugAddress(70, 23);
        rack->setLugAddress(71, 24);
        rack->setLugAddress(72, 29);
        rack->setLugAddress(73, 30);
        rack->setLugAddress(74, 35);
        rack->setLugAddress(75, 36);
        rack->setLugAddress(76, 41);
        rack->setLugAddress(77, 42);
        rack->setLugAddress(78, 47);
        rack->setLugAddress(79, 48);
        rack->setLugAddress(80, 53);
        rack->setLugAddress(81, 54);
        rack->setLugAddress(82, 59);
        rack->setLugAddress(83, 60);
        rack->setLugAddress(84, 65);
        rack->setLugAddress(85, 66);
        rack->setLugAddress(86, 71);
        rack->setLugAddress(87, 72);
        rack->setLugAddress(88, 77);
        rack->setLugAddress(89, 78);
        rack->setLugAddress(90, 83);
        rack->setLugAddress(91, 84);
        rack->setLugAddress(92, 89);
        rack->setLugAddress(93, 90);
        rack->setLugAddress(94, 95);
        rack->setLugAddress(95, 96);

        // Rack 1
        rack = rom_->addRack(1, patchman::Rack::Type::Enr96);
        rack->setLugAddress(0, 97);
        rack->setLugAddress(1, 98);
        rack->setLugAddress(2, 103);
        rack->setLugAddress(3, 104);
        rack->setLugAddress(4, 109);
        rack->setLugAddress(5, 110);
        rack->setLugAddress(6, 115);
        rack->setLugAddress(7, 116);
        rack->setLugAddress(8, 121);
        rack->setLugAddress(9, 122);
        rack->setLugAddress(10, 127);
        rack->setLugAddress(11, 128);
        rack->setLugAddress(12, 133);
        rack->setLugAddress(13, 134);
        rack->setLugAddress(14, 139);
        rack->setLugAddress(15, 140);
        rack->setLugAddress(16, 145);
        rack->setLugAddress(17, 146);
        rack->setLugAddress(18, 151);
        rack->setLugAddress(19, 152);
        rack->setLugAddress(20, 157);
        rack->setLugAddress(21, 158);
        rack->setLugAddress(22, 163);
        rack->setLugAddress(23, 164);
        rack->setLugAddress(24, 169);
        rack->setLugAddress(25, 170);
        rack->setLugAddress(26, 175);
        rack->setLugAddress(27, 176);
        rack->setLugAddress(28, 181);
        rack->setLugAddress(29, 182);
        rack->setLugAddress(30, 187);
        rack->setLugAddress(31, 188);
        rack->setLugAddress(32, 99);
        rack->setLugAddress(33, 100);
        rack->setLugAddress(34, 105);
        rack->setLugAddress(35, 106);
        rack->setLugAddress(36, 111);
        rack->setLugAddress(37, 112);
        rack->setLugAddress(38, 117);
        rack->setLugAddress(39, 118);
        rack->setLugAddress(40, 123);
        rack->setLugAddress(41, 124);
        rack->setLugAddress(42, 129);
        rack->setLugAddress(43, 130);
        rack->setLugAddress(44, 135);
        rack->setLugAddress(45, 136);
        rack->setLugAddress(46, 141);
        rack->setLugAddress(47, 142);
        rack->setLugAddress(48, 147);
        rack->setLugAddress(49, 148);
        rack->setLugAddress(50, 153);
        rack->setLugAddress(51, 154);
        rack->setLugAddress(52, 159);
        rack->setLugAddress(53, 160);
        rack->setLugAddress(54, 165);
        rack->setLugAddress(55, 166);
        rack->setLugAddress(56, 171);
        rack->setLugAddress(57, 172);
        rack->setLugAddress(58, 177);
        rack->setLugAddress(59, 178);
        rack->setLugAddress(60, 183);
        rack->setLugAddress(61, 184);
        rack->setLugAddress(62, 189);
        rack->setLugAddress(63, 190);
        rack->setLugAddress(64, 101);
        rack->setLugAddress(65, 102);
        rack->setLugAddress(66, 107);
        rack->setLugAddress(67, 108);
        rack->setLugAddress(68, 113);
        rack->setLugAddress(69, 114);
        rack->setLugAddress(70, 119);
        rack->setLugAddress(71, 120);
        rack->setLugAddress(72, 125);
        rack->setLugAddress(73, 126);
        rack->setLugAddress(74, 131);
        rack->setLugAddress(75, 132);
        rack->setLugAddress(76, 137);
        rack->setLugAddress(77, 138);
        rack->setLugAddress(78, 143);
        rack->setLugAddress(79, 144);
        rack->setLugAddress(80, 149);
        rack->setLugAddress(81, 150);
        rack->setLugAddress(82, 155);
        rack->setLugAddress(83, 156);
        rack->setLugAddress(84, 161);
        rack->setLugAddress(85, 162);
        rack->setLugAddress(86, 167);
        rack->setLugAddress(87, 168);
        rack->setLugAddress(88, 173);
        rack->setLugAddress(89, 174);
        rack->setLugAddress(90, 179);
        rack->setLugAddress(91, 180);
        rack->setLugAddress(92, 185);
        rack->setLugAddress(93, 186);
        rack->setLugAddress(94, 191);
        rack->setLugAddress(95, 192);

        // Rack 2
        rack = rom_->addRack(2, patchman::Rack::Type::Enr96);
        rack->setLugAddress(0, 193);
        rack->setLugAddress(1, 194);
        rack->setLugAddress(2, 199);
        rack->setLugAddress(3, 200);
        rack->setLugAddress(4, 205);
        rack->setLugAddress(5, 206);
        rack->setLugAddress(6, 211);
        rack->setLugAddress(7, 212);
        rack->setLugAddress(8, 217);
        rack->setLugAddress(9, 218);
        rack->setLugAddress(10, 223);
        rack->setLugAddress(11, 224);
        rack->setLugAddress(12, 229);
        rack->setLugAddress(13, 230);
        rack->setLugAddress(14, 235);
        rack->setLugAddress(15, 236);
        rack->setLugAddress(16, 241);
        rack->setLugAddress(17, 242);
        rack->setLugAddress(18, 247);
        rack->setLugAddress(19, 248);
        rack->setLugAddress(20, 253);
        rack->setLugAddress(21, 254);
        rack->setLugAddress(22, 259);
        rack->setLugAddress(23, 260);
        rack->setLugAddress(24, 265);
        rack->setLugAddress(25, 266);
        rack->setLugAddress(26, 271);
        rack->setLugAddress(27, 272);
        rack->setLugAddress(28, 277);
        rack->setLugAddress(29, 278);
        rack->setLugAddress(30, 283);
        rack->setLugAddress(31, 284);
        rack->setLugAddress(32, 195);
        rack->setLugAddress(33, 196);
        rack->setLugAddress(34, 201);
        rack->setLugAddress(35, 202);
        rack->setLugAddress(36, 207);
        rack->setLugAddress(37, 208);
        rack->setLugAddress(38, 213);
        rack->setLugAddress(39, 214);
        rack->setLugAddress(40, 219);
        rack->setLugAddress(41, 220);
        rack->setLugAddress(42, 225);
        rack->setLugAddress(43, 226);
        rack->setLugAddress(44, 231);
        rack->setLugAddress(45, 232);
        rack->setLugAddress(46, 237);
        rack->setLugAddress(47, 238);
        rack->setLugAddress(48, 243);
        rack->setLugAddress(49, 244);
        rack->setLugAddress(50, 249);
        rack->setLugAddress(51, 250);
        rack->setLugAddress(52, 255);
        rack->setLugAddress(53, 256);
        rack->setLugAddress(54, 261);
        rack->setLugAddress(55, 262);
        rack->setLugAddress(56, 267);
        rack->setLugAddress(57, 268);
        rack->setLugAddress(58, 273);
        rack->setLugAddress(59, 274);
        rack->setLugAddress(60, 279);
        rack->setLugAddress(61, 280);
        rack->setLugAddress(62, 285);
        rack->setLugAddress(63, 286);
        rack->setLugAddress(64, 197);
        rack->setLugAddress(65, 198);
        rack->setLugAddress(66, 203);
        rack->setLugAddress(67, 204);
        rack->setLugAddress(68, 209);
        rack->setLugAddress(69, 210);
        rack->setLugAddress(70, 215);
        rack->setLugAddress(71, 216);
        rack->setLugAddress(72, 221);
        rack->setLugAddress(73, 222);
        rack->setLugAddress(74, 227);
        rack->setLugAddress(75, 228);
        rack->setLugAddress(76, 233);
        rack->setLugAddress(77, 234);
        rack->setLugAddress(78, 239);
        rack->setLugAddress(79, 240);
        rack->setLugAddress(80, 245);
        rack->setLugAddress(81, 246);
        rack->setLugAddress(82, 251);
        rack->setLugAddress(83, 252);
        rack->setLugAddress(84, 257);
        rack->setLugAddress(85, 258);
        rack->setLugAddress(86, 263);
        rack->setLugAddress(87, 264);
        rack->setLugAddress(88, 269);
        rack->setLugAddress(89, 270);
        rack->setLugAddress(90, 275);
        rack->setLugAddress(91, 276);
        rack->setLugAddress(92, 281);
        rack->setLugAddress(93, 282);
        rack->setLugAddress(94, 287);
        rack->setLugAddress(95, 288);

        // Rack 3
        rack = rom_->addRack(3, patchman::Rack::Type::Enr96);
        rack->setLugAddress(0, 289);
        rack->setLugAddress(1, 290);
        rack->setLugAddress(2, 295);
        rack->setLugAddress(3, 296);
        rack->setLugAddress(4, 301);
        rack->setLugAddress(5, 302);
        rack->setLugAddress(6, 307);
        rack->setLugAddress(7, 308);
        rack->setLugAddress(8, 313);
        rack->setLugAddress(9, 314);
        rack->setLugAddress(10, 319);
        rack->setLugAddress(11, 320);
        rack->setLugAddress(12, 325);
        rack->setLugAddress(13, 326);
        rack->setLugAddress(14, 331);
        rack->setLugAddress(15, 332);
        rack->setLugAddress(16, 337);
        rack->setLugAddress(17, 338);
        rack->setLugAddress(18, 343);
        rack->setLugAddress(19, 344);
        rack->setLugAddress(20, 349);
        rack->setLugAddress(21, 350);
        rack->setLugAddress(22, 355);
        rack->setLugAddress(23, 356);
        rack->setLugAddress(24, 361);
        rack->setLugAddress(25, 362);
        rack->setLugAddress(26, 367);
        rack->setLugAddress(27, 368);
        rack->setLugAddress(28, 373);
        rack->setLugAddress(29, 374);
        rack->setLugAddress(30, 379);
        rack->setLugAddress(31, 380);
        rack->setLugAddress(32, 291);
        rack->setLugAddress(33, 292);
        rack->setLugAddress(34, 297);
        rack->setLugAddress(35, 298);
        rack->setLugAddress(36, 303);
        rack->setLugAddress(37, 304);
        rack->setLugAddress(38, 309);
        rack->setLugAddress(39, 310);
        rack->setLugAddress(40, 315);
        rack->setLugAddress(41, 316);
        rack->setLugAddress(42, 321);
        rack->setLugAddress(43, 322);
        rack->setLugAddress(44, 327);
        rack->setLugAddress(45, 328);
        rack->setLugAddress(46, 333);
        rack->setLugAddress(47, 334);
        rack->setLugAddress(48, 339);
        rack->setLugAddress(49, 340);
        rack->setLugAddress(50, 345);
        rack->setLugAddress(51, 346);
        rack->setLugAddress(52, 351);
        rack->setLugAddress(53, 352);
        rack->setLugAddress(54, 357);
        rack->setLugAddress(55, 358);
        rack->setLugAddress(56, 363);
        rack->setLugAddress(57, 364);
        rack->setLugAddress(58, 369);
        rack->setLugAddress(59, 370);
        rack->setLugAddress(60, 375);
        rack->setLugAddress(61, 376);
        rack->setLugAddress(62, 381);
        rack->setLugAddress(63, 382);
        rack->setLugAddress(64, 293);
        rack->setLugAddress(65, 294);
        rack->setLugAddress(66, 299);
        rack->setLugAddress(67, 300);
        rack->setLugAddress(68, 305);
        rack->setLugAddress(69, 306);
        rack->setLugAddress(70, 311);
        rack->setLugAddress(71, 312);
        rack->setLugAddress(72, 317);
        rack->setLugAddress(73, 318);
        rack->setLugAddress(74, 323);
        rack->setLugAddress(75, 324);
        rack->setLugAddress(76, 329);
        rack->setLugAddress(77, 330);
        rack->setLugAddress(78, 335);
        rack->setLugAddress(79, 336);
        rack->setLugAddress(80, 341);
        rack->setLugAddress(81, 342);
        rack->setLugAddress(82, 347);
        rack->setLugAddress(83, 348);
        rack->setLugAddress(84, 353);
        rack->setLugAddress(85, 354);
        rack->setLugAddress(86, 359);
        rack->setLugAddress(87, 360);
        rack->setLugAddress(88, 365);
        rack->setLugAddress(89, 366);
        rack->setLugAddress(90, 371);
        rack->setLugAddress(91, 372);
        rack->setLugAddress(92, 377);
        rack->setLugAddress(93, 378);
        rack->setLugAddress(94, 383);
        rack->setLugAddress(95, 384);

        // Rack 4
        rack = rom_->addRack(4, patchman::Rack::Type::Enr96);
        rack->setLugAddress(0, 385);
        rack->setLugAddress(1, 386);
        rack->setLugAddress(2, 391);
        rack->setLugAddress(3, 392);
        rack->setLugAddress(4, 397);
        rack->setLugAddress(5, 398);
        rack->setLugAddress(6, 403);
        rack->setLugAddress(7, 404);
        rack->setLugAddress(8, 409);
        rack->setLugAddress(9, 410);
        rack->setLugAddress(10, 415);
        rack->setLugAddress(11, 416);
        rack->setLugAddress(12, 421);
        rack->setLugAddress(13, 422);
        rack->setLugAddress(14, 427);
        rack->setLugAddress(15, 428);
        rack->setLugAddress(16, 433);
        rack->setLugAddress(17, 434);
        rack->setLugAddress(18, 439);
        rack->setLugAddress(19, 440);
        rack->setLugAddress(20, 445);
        rack->setLugAddress(21, 446);
        rack->setLugAddress(22, 451);
        rack->setLugAddress(23, 452);
        rack->setLugAddress(24, 457);
        rack->setLugAddress(25, 458);
        rack->setLugAddress(26, 463);
        rack->setLugAddress(27, 464);
        rack->setLugAddress(28, 469);
        rack->setLugAddress(29, 470);
        rack->setLugAddress(30, 475);
        rack->setLugAddress(31, 476);
        rack->setLugAddress(32, 387);
        rack->setLugAddress(33, 388);
        rack->setLugAddress(34, 393);
        rack->setLugAddress(35, 394);
        rack->setLugAddress(36, 399);
        rack->setLugAddress(37, 400);
        rack->setLugAddress(38, 405);
        rack->setLugAddress(39, 406);
        rack->setLugAddress(40, 411);
        rack->setLugAddress(41, 412);
        rack->setLugAddress(42, 417);
        rack->setLugAddress(43, 418);
        rack->setLugAddress(44, 423);
        rack->setLugAddress(45, 424);
        rack->setLugAddress(46, 429);
        rack->setLugAddress(47, 430);
        rack->setLugAddress(48, 435);
        rack->setLugAddress(49, 436);
        rack->setLugAddress(50, 441);
        rack->setLugAddress(51, 442);
        rack->setLugAddress(52, 447);
        rack->setLugAddress(53, 448);
        rack->setLugAddress(54, 453);
        rack->setLugAddress(55, 454);
        rack->setLugAddress(56, 459);
        rack->setLugAddress(57, 460);
        rack->setLugAddress(58, 465);
        rack->setLugAddress(59, 466);
        rack->setLugAddress(60, 471);
        rack->setLugAddress(61, 472);
        rack->setLugAddress(62, 477);
        rack->setLugAddress(63, 478);
        rack->setLugAddress(64, 389);
        rack->setLugAddress(65, 390);
        rack->setLugAddress(66, 395);
        rack->setLugAddress(67, 396);
        rack->setLugAddress(68, 401);
        rack->setLugAddress(69, 402);
        rack->setLugAddress(70, 407);
        rack->setLugAddress(71, 408);
        rack->setLugAddress(72, 413);
        rack->setLugAddress(73, 414);
        rack->setLugAddress(74, 419);
        rack->setLugAddress(75, 420);
        rack->setLugAddress(76, 425);
        rack->setLugAddress(77, 426);
        rack->setLugAddress(78, 431);
        rack->setLugAddress(79, 432);
        rack->setLugAddress(80, 437);
        rack->setLugAddress(81, 438);
        rack->setLugAddress(82, 443);
        rack->setLugAddress(83, 444);
        rack->setLugAddress(84, 449);
        rack->setLugAddress(85, 450);
        rack->setLugAddress(86, 455);
        rack->setLugAddress(87, 456);
        rack->setLugAddress(88, 461);
        rack->setLugAddress(89, 462);
        rack->setLugAddress(90, 467);
        rack->setLugAddress(91, 468);
        rack->setLugAddress(92, 473);
        rack->setLugAddress(93, 474);
        rack->setLugAddress(94, 479);
        rack->setLugAddress(95, 480);

        // Rack 5
        rack = rom_->addRack(5, patchman::Rack::Type::Enr96);
        rack->setLugAddress(0, 481);
        rack->setLugAddress(1, 482);
        rack->setLugAddress(2, 487);
        rack->setLugAddress(3, 488);
        rack->setLugAddress(4, 493);
        rack->setLugAddress(5, 494);
        rack->setLugAddress(6, 499);
        rack->setLugAddress(7, 500);
        rack->setLugAddress(8, 505);
        rack->setLugAddress(9, 506);
        rack->setLugAddress(10, 511);
        // ENR can't address 512 because a 9-bit unsigned int maxes out at 511.
        rack->setLugAddress(11, 0);
        rack->setLugAddress(12, 0);
        rack->setLugAddress(13, 0);
        rack->setLugAddress(14, 0);
        rack->setLugAddress(15, 0);
        rack->setLugAddress(16, 0);
        rack->setLugAddress(17, 0);
        rack->setLugAddress(18, 0);
        rack->setLugAddress(19, 0);
        rack->setLugAddress(20, 0);
        rack->setLugAddress(21, 0);
        rack->setLugAddress(22, 0);
        rack->setLugAddress(23, 0);
        rack->setLugAddress(24, 0);
        rack->setLugAddress(25, 0);
        rack->setLugAddress(26, 0);
        rack->setLugAddress(27, 0);
        rack->setLugAddress(28, 0);
        rack->setLugAddress(29, 0);
        rack->setLugAddress(30, 0);
        rack->setLugAddress(31, 0);
        rack->setLugAddress(32, 483);
        rack->setLugAddress(33, 484);
        rack->setLugAddress(34, 489);
        rack->setLugAddress(35, 490);
        rack->setLugAddress(36, 495);
        rack->setLugAddress(37, 496);
        rack->setLugAddress(38, 501);
        rack->setLugAddress(39, 502);
        rack->setLugAddress(40, 507);
        rack->setLugAddress(41, 508);
        rack->setLugAddress(42, 0);
        rack->setLugAddress(43, 0);
        rack->setLugAddress(44, 0);
        rack->setLugAddress(45, 0);
        rack->setLugAddress(46, 0);
        rack->setLugAddress(47, 0);
        rack->setLugAddress(48, 0);
        rack->setLugAddress(49, 0);
        rack->setLugAddress(50, 0);
        rack->setLugAddress(51, 0);
        rack->setLugAddress(52, 0);
        rack->setLugAddress(53, 0);
        rack->setLugAddress(54, 0);
        rack->setLugAddress(55, 0);
        rack->setLugAddress(56, 0);
        rack->setLugAddress(57, 0);
        rack->setLugAddress(58, 0);
        rack->setLugAddress(59, 0);
        rack->setLugAddress(60, 0);
        rack->setLugAddress(61, 0);
        rack->setLugAddress(62, 0);
        rack->setLugAddress(63, 0);
        rack->setLugAddress(64, 485);
        rack->setLugAddress(65, 486);
        rack->setLugAddress(66, 491);
        rack->setLugAddress(67, 492);
        rack->setLugAddress(68, 497);
        rack->setLugAddress(69, 498);
        rack->setLugAddress(70, 503);
        rack->setLugAddress(71, 504);
        rack->setLugAddress(72, 509);
        rack->setLugAddress(73, 510);
        rack->setLugAddress(74, 0);
        rack->setLugAddress(75, 0);
        rack->setLugAddress(76, 0);
        rack->setLugAddress(77, 0);
        rack->setLugAddress(78, 0);
        rack->setLugAddress(79, 0);
        rack->setLugAddress(80, 0);
        rack->setLugAddress(81, 0);
        rack->setLugAddress(82, 0);
        rack->setLugAddress(83, 0);
        rack->setLugAddress(84, 0);
        rack->setLugAddress(85, 0);
        rack->setLugAddress(86, 0);
        rack->setLugAddress(87, 0);
        rack->setLugAddress(88, 0);
        rack->setLugAddress(89, 0);
        rack->setLugAddress(90, 0);
        rack->setLugAddress(91, 0);
        rack->setLugAddress(92, 0);
        rack->setLugAddress(93, 0);
        rack->setLugAddress(94, 0);
        rack->setLugAddress(95, 0);
    }
};

TEST_CASE_METHOD(EnrFixture, "ENR Load")
{
    SECTION("Read ENR ROM") {
        auto *actual = dynamic_cast<patchman::EnrRom *>(patchman::Rom::create(patchman::Rom::Type::ENR));
        actual->loadFromData(romBin_);
        REQUIRE(*rom_ == *actual);
    }

    SECTION("Wrong ROM type") {
        auto *actual = dynamic_cast<patchman::EnrRom *>(patchman::Rom::create(patchman::Rom::Type::ENR));
        const QByteArrayView badPatchRomView({0, 0, 0, 0, 0});
        REQUIRE_THROWS_AS(actual->loadFromData(badPatchRomView), patchman::InvalidRomException);
    }
}

TEST_CASE_METHOD(EnrFixture, "ENR Count Racks")
{
    REQUIRE(rom_->countPatchedRacks() == 6);
}

TEST_CASE_METHOD(EnrFixture, "ENR Save")
{
    const auto actual = rom_->toByteArray();
    REQUIRE(romBin_.size() == actual.size());
    for (qsizetype ix = 0; ix < romBin_.size() && ix < actual.size(); ++ix) {
        if (static_cast<uint8_t>(romBin_[ix]) != static_cast<uint8_t>(actual[ix])) {
            FAIL("Mismatch at ix " << ix << " (Got " << static_cast<int>(actual[ix]) << " expected "
                                   << static_cast<unsigned int>(romBin_[ix]) << ")\n"
                                   << "Expected data:" << formatBytes(romBin_.cbegin(), romBin_.cend())
                                   << "Actual data:" << formatBytes(actual.cbegin(), actual.cend()));
        }
    }
}
